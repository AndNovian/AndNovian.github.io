<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.2"><meta name=generator content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862"><meta name=description content="How to isolate multiple devices using Sentinel Playbook (Logic App) and MDE API, based on device tags or groups"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Sentinel Playbook: Device Isolation Using MDE API (Part 1 - API Setup) :: Novian Andrian"><meta name=twitter:description content="How to isolate multiple devices using Sentinel Playbook (Logic App) and MDE API, based on device tags or groups"><meta property="og:url" content="https://andnovian.github.io/blog/defender/003.takeresponseapi1/index.html"><meta property="og:site_name" content="Novian Andrian"><meta property="og:title" content="Sentinel Playbook: Device Isolation Using MDE API (Part 1 - API Setup) :: Novian Andrian"><meta property="og:description" content="How to isolate multiple devices using Sentinel Playbook (Logic App) and MDE API, based on device tags or groups"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Sentinel Playbook: Device Isolation Using MDE API (Part 1 - API Setup) :: Novian Andrian"><meta itemprop=description content="How to isolate multiple devices using Sentinel Playbook (Logic App) and MDE API, based on device tags or groups"><meta itemprop=wordCount content="1130"><meta itemprop=keywords content="Sentinel,Defender,API,LogicApp,Isolation"><title>Sentinel Playbook: Device Isolation Using MDE API (Part 1 - API Setup) :: Novian Andrian</title><link href=/blog/defender/003.takeresponseapi1/index.xml rel=alternate type=application/rss+xml title="Sentinel Playbook: Device Isolation Using MDE API (Part 1 - API Setup) :: Novian Andrian"><link href=/css/auto-complete/auto-complete.min.css?1754897756 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1754897756 defer></script><script src=/js/search-lunr.min.js?1754897756 defer></script><script src=/js/search.min.js?1754897756 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1754897756"</script><script src=/js/lunr/lunr.min.js?1754897756 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1754897756 defer></script><script src=/js/lunr/lunr.multi.min.js?1754897756 defer></script><script src=/js/lunr/lunr.en.min.js?1754897756 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1754897756 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1754897756 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1754897756 rel=stylesheet><link href=/css/theme.min.css?1754897756 rel=stylesheet><link href=/css/format-html.min.css?1754897756 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/blog/defender/003.takeresponseapi1/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://andnovian.github.io",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!1,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["zen-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script></head><body class="mobile-support html" data-url=/blog/defender/003.takeresponseapi1/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#step-1-creating-api-application-and-the-required-permission>Step 1: Creating API Application and the Required &ndash;Permission</a></li><li><a href=#step-2-store-the-secret-in-azure-key-vault>Step 2: Store the Secret in Azure Key Vault</a></li><li><a href=#optional-testing-the-api-call>Optional: Testing the API call</a></li><li><a href=#wrapping-up-laying-out-api-foundation-for-boundless-potential>Wrapping Up: Laying Out API Foundation for Boundless Potential</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement class=a11y-only><a itemprop=item href=/index.html><span itemprop=name>Welcome</span></a><meta itemprop=position content="1">&nbsp;>>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/blog/index.html><span itemprop=name>Blog Post</span></a><meta itemprop=position content="2">&nbsp;>>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/blog/defender/index.html><span itemprop=name>MS Defender</span></a><meta itemprop=position content="3">&nbsp;>>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Sentinel Playbook: Device Isolation Using MDE API #1</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/blog/defender/004.takeresponseapi2/index.html title="Sentinel Playbook: Device Isolation Using MDE API (Part 2 - Logic App) (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/blog/defender/002.live-analyzer/index.html title="Live Response to Remotely Collect Defender Logs (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable blog" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline><div class="R-taxonomy taxonomy-tags cstyle tags" title=Tags style=--VARIABLE-TAGS-BG-color:var(--INTERNAL-TAG-BG-color)><ul><li><a class=term-link href=/tags/api/index.html>API</a></li><li><a class=term-link href=/tags/defender/index.html>Defender</a></li><li><a class=term-link href=/tags/isolation/index.html>Isolation</a></li><li><a class=term-link href=/tags/logicapp/index.html>LogicApp</a></li><li><a class=term-link href=/tags/sentinel/index.html>Sentinel</a></li></ul></div></header><h1 id=sentinel-playbook-device-isolation-using-mde-api-part-1---api-setup>Sentinel Playbook: Device Isolation Using MDE API (Part 1 - API Setup)</h1><hr><p>Recently, I was browsing the sub-Reddit of <a href=https://www.reddit.com/r/DefenderATP rel=external target=_blank>Defender ATP</a> and came across a post asking about using Sentinel Playbook to <a href=https://www.reddit.com/r/DefenderATP/comments/1lx1n0a/playbook_to_isolate_multiple_devices_part_of_a/ rel=external target=_blank>Isolate Multiple Devices that are part of a specific MDE Tag/Group</a>. This intrigued me, as many people might initially try to use Advanced Hunting (Custom Detection Rule) for this task. However, data about MDE device tags or groups is often incomplete or inconsistent in Advanced Hunting—this data is more reliably accessible through the MDE API.</p><p>Here is the flow:<pre class="mermaid align-center zoomable">
graph LR;
  trigger[&#34;Trigger&lt;br&gt;(Manual or Incident)&#34;] --&gt; api[&#34;GET Machine List&lt;br&gt;MachineID by Tag/Group&#34;] --&gt; api2[&#34;POST Isolate Machine&lt;br&gt;Isolate all MachineID&#34;]
</pre></p><p>This guide is part one of a proof of concept, that will show you how to Isolate Device with Sentinel Playbook (Logic Apps) and data from MDE API. It will help you with the following scenario:</p><ol><li>You want to bulk Isolate or Unisolate Device, targeting specific parameter, such as Device Tag/Group.</li><li>You want an automation flow to Isolate or Unisolate Device using API.</li></ol><p>What You&rsquo;ll learn in this part one:</p><ul><li>How to use Microsoft Defender API</li><li>How to register an Azure App and get API access</li><li>How to securely store secrets in Azure Key Vault</li><li>How to test and validate your API token before building a Logic App</li></ul><p>Scope & Requirements:</p><ol><li>Administrator access to create <a href=https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference rel=external target=_blank>App Registration in Azure portal</a>.</li><li>Administrator access to create or modify <a href="https://learn.microsoft.com/en-us/azure/key-vault/general/rbac-guide?tabs=azure-cli" rel=external target=_blank>Azure Key Vault</a>.</li><li>Based on <a href=https://learn.microsoft.com/en-us/defender-endpoint/respond-machine-alerts#isolate-devices-from-the-network rel=external target=_blank>Isolation feature</a> and its limitation (such as OS).</li><li><a href=https://learn.microsoft.com/en-us/defender-endpoint/api/isolate-machine rel=external target=_blank>Isolate API limitation</a>, such as 100 calls per minute or 1500 calls per hour.</li></ol><p>Similar reference to this method is also available in this <a href=https://github.com/Azure/Azure-Sentinel/tree/master/Playbooks/AS-MDE-Isolate-Machine rel=external target=_blank>Github page</a>.</p><hr><h2 id=step-1-creating-api-application-and-the-required-permission>Step 1: Creating API Application and the Required &ndash;Permission</h2><p>Our first step to use API is to create an App with right permission, as a means of Authorization to access our MDE resources.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>If you are not familiar with MDE API, I highly suggest to get familiar with <a href=https://learn.microsoft.com/en-us/defender-endpoint/api/api-hello-world rel=external target=_blank>MDE API Hello World docs</a> first.</p></div></details><ul><li><p>Go to <strong>Azure Portal</strong> > and search for <a href=https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationsListBlade rel=external target=_blank><strong>App registration</strong></a>, and click fo <strong>New registration</strong>.</p></li><li><p>Fill up the name and click <strong>Register</strong>, we don&rsquo;t need to modify other parameter.
<a href=#R-image-73eb859a26e5810f9784cadef8c82074 class=lightbox-link><img alt=appRegistration1 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-73eb859a26e5810f9784cadef8c82074><img alt=appRegistration1 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration1.png></a></p></li><li><p>On the left panel, click on <strong>Manage</strong> > <strong>API permissions</strong> blade.</p></li><li><p>Click on <strong>Add a permission</strong> > <strong>APIs my organization uses</strong> > <strong>WindowsDefenderATP</strong>.
<a href=#R-image-6e59bace7af9b57e84eec9b88807596b class=lightbox-link><img alt=appRegistration2 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6e59bace7af9b57e84eec9b88807596b><img alt=appRegistration2 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration2.png></a></p></li><li><p>Select <strong>Application permissions</strong> > and tick <strong>Machine.Isolate</strong> and <strong>Machine.ReadAll</strong>
<a href=#R-image-62ed7a30698b563e987e4c4ae17a9e58 class=lightbox-link><img alt=appRegistration3 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-62ed7a30698b563e987e4c4ae17a9e58><img alt=appRegistration3 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration3.png></a><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>For targeted isolation, we need <strong>Machine.Isolate</strong> and <strong>Machine.ReadAll</strong> permissions, as per API documentation about <a href=https://learn.microsoft.com/en-us/defender-endpoint/api/isolate-machine#permissions rel=external target=_blank>Isolate Machine</a> and <a href=https://learn.microsoft.com/en-us/defender-endpoint/api/get-machines#permissions rel=external target=_blank>List Machine</a>.</p><p><a href=#R-image-9e40ba08fca5611180699b75a1ed3fc7 class=lightbox-link><img alt=appRegistration4 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9e40ba08fca5611180699b75a1ed3fc7><img alt=appRegistration4 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration4.png></a></p></div></details></p></li><li><p>Once you add the permission, you will be back at <strong>API permissions</strong> blade, click <strong>Grant admin consent for xxx</strong>
<a href=#R-image-ddb2f47df24206ede29e3ecd0d880ec9 class=lightbox-link><img alt=appRegistration5 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ddb2f47df24206ede29e3ecd0d880ec9><img alt=appRegistration5 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration5.png></a></p></li><li><p>Go to <strong>Certificates & secrets</strong> blade and select <strong>New client secret</strong>. Put the description, and specify the secret validity. Click <strong>Add</strong>.</p></li></ul><ul><li>You will get your <strong>secret value</strong> here, copy it somewhere safe, as you only have access to it once. If you lost it, you need to recreate this step. Also later in the step, we will need to retrieve this value.
<a href=#R-image-38bde9c5883d332ccd28839054c4a589 class=lightbox-link><img alt=appRegistration6 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-38bde9c5883d332ccd28839054c4a589><img alt=appRegistration6 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration6.png></a><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>This secret will be acting like your password to access your API, whenever you wants to access MDE API, you or your application will need to present the secret value to authorize.</p></div></details></li></ul><ul><li>Now, go to the <strong>Overview</strong> blade, and copy the value of <strong>Application (client) ID</strong> and <strong>Directory (tenant) ID</strong>.
<a href=#R-image-0e4e6451376b2ea04d3eaeb302822e6c class=lightbox-link><img alt=appRegistration7 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration7.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0e4e6451376b2ea04d3eaeb302822e6c><img alt=appRegistration7 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/appRegistration7.png></a><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>Now you have 3 values that will be needed when making authorized API call. In most modern API platforms that use OAuth 2.0 (such as Microsoft, Google, Okta, and others), these values are essential for issuing an access token, which is then used to authenticate your API requests.</p><ul><li>Secret Value</li><li>Application / Client ID</li><li>Directory / Tenant ID</li></ul></div></details></li></ul><h2 id=step-2-store-the-secret-in-azure-key-vault>Step 2: Store the Secret in Azure Key Vault</h2><p>We will be storing the secret in Azure Key Vault to securely protect them and only allow the required Azure&rsquo;s service (Logic App that we will create later) to access them.</p><ul><li>From <strong>Azure Portal</strong> > search <a href=https://portal.azure.com/#browse/Microsoft.KeyVault%2Fvaults rel=external target=_blank><strong>Key Vaults</strong></a> > <strong>Create</strong> a new Key Vault.</li><li>For this testing purpose, we go with all default settings and create the Vault.</li><li>Go to the Key Vault resource created, on left side click <strong>Access control (IAM)</strong> blade to give RBAC access to add the secrets.</li><li>Click <strong>Add</strong> > <strong>Add role assignment</strong>. For this test I will assign <strong>Key Vault Administrator</strong>, and add my own account as the member.</li><li>Now, on the left panel go to <strong>Objects</strong> > <strong>Secrets</strong> blade. Then click <strong>Generate/Import</strong>.
<a href=#R-image-d9ca292f3483b0767a28f7425a074db9 class=lightbox-link><img alt=keyVault1 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/keyVault1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d9ca292f3483b0767a28f7425a074db9><img alt=keyVault1 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/keyVault1.png></a></li><li>Input the <strong>Secret value</strong> that you have from the previous step here.
<a href=#R-image-d92d215d8499bb50d490674342455d40 class=lightbox-link><img alt=keyVault2 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/keyVault2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d92d215d8499bb50d490674342455d40><img alt=keyVault2 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/keyVault2.png></a><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>In Production environment, you might want to limit the IAM to <strong>Key Vault Secrets Officer</strong> to only allow managing/adding the Secret value.</p><p>Reference - <a href="https://learn.microsoft.com/en-us/azure/key-vault/general/rbac-guide?tabs=azure-portal#azure-built-in-roles-for-key-vault-data-plane-operations" rel=external target=_blank>Azure built-in roles for Key Vault data plane operations</a></p></div></details></li></ul><h2 id=optional-testing-the-api-call>Optional: Testing the API call</h2><p>If you want to test on how your API works, you can follow this section. Otherwise, if you are familiar with API already, you can skip this section.</p><p>First, download the following powershell script to get the token, and do the API call.<details open class="box cstyle attachments transparent"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-paperclip"></i>
Attachments</summary><ul class="attachments-files box-content"><li><a href=/blog/defender/003.takeresponseapi1/Get-Token.ps1>Get-Token.ps1</a> (854 B)</li><li><a href=/blog/defender/003.takeresponseapi1/Get-DeviceList.ps1>Get-DeviceList.ps1</a> (585 B)</li></ul></details></p><ul><li>Inside the <strong>Get-Token.ps1</strong> you want to modify tenantId, appId and appSecret with the value you get from <a href=/blog/defender/003.takeresponseapi1/index.html#step-1-creating-api-application-and-the-required-permission>Step 1</a>
<a href=#R-image-8ab2a87c52858babf82148e40ef6bb8f class=lightbox-link><img alt=apiTest1 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/apiTest1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8ab2a87c52858babf82148e40ef6bb8f><img alt=apiTest1 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/apiTest1.png></a></li><li>Open Powershell.exe and run the .\Get-Token.ps1<details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>If you encounter <strong>UnauthorizedAccess</strong> error, you can temporarily disable powershell Execution policy, this will only affect the current Powershell instance:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>Set-ExecutionPolicy Bypass -Scope Process</code></pre></div></div></details><a href=#R-image-33150b6fabf8798b0919370bc1444724 class=lightbox-link><img alt=apiTest2 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/apiTest2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-33150b6fabf8798b0919370bc1444724><img alt=apiTest2 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/apiTest2.png></a></li><li>Go to <a href=https://jwt.ms/ rel=external target=_blank>jwt.ms</a> and paste the token above.</li><li>You should see the roles we applied earlier. If you don&rsquo;t see it, it means your Step 1 App registration permission is not applied. Try to redo <a href=/blog/defender/003.takeresponseapi1/index.html#step-1-creating-api-application-and-the-required-permission>Step 1</a>.
<a href=#R-image-e88421e4c5b723388045c6abd202e834 class=lightbox-link><img alt=apiTest3 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/apiTest3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e88421e4c5b723388045c6abd202e834><img alt=apiTest3 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/apiTest3.png></a></li></ul><p>Next, we want to try and call the Get machine list API, to see the output of the API.</p><ul><li>Run <strong>Get-DeviceList.ps1</strong>, make sure both <strong>Get-Token.ps1</strong> is also at the same folder.</li><li>You should see the details of 1 machine in your MDE tenant. Including, <strong>machineTags</strong> or <strong>rbacGroupName (Device Group)</strong> which we will use in part 2, to target and filter these devices.
<a href=#R-image-af6d69d2210f512a030e2b9d5a99d3b5 class=lightbox-link><img alt=apiTest4 class="lazy lightbox figure-image" loading=lazy src=/blog/defender/003.takeresponseapi1/apiTest4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-af6d69d2210f512a030e2b9d5a99d3b5><img alt=apiTest4 class="lazy lightbox lightbox-image" loading=lazy src=/blog/defender/003.takeresponseapi1/apiTest4.png></a></li></ul><p>That&rsquo;s pretty much how API works, without MDE portal and just using a script, you can now access data in your MDE tenant. In this example, you are accessing Devices data.</p><p>The more you get familiar with <a href=https://learn.microsoft.com/en-us/defender-endpoint/api/exposed-apis-list rel=external target=_blank>MDE API list</a>, you will see many other datas you can obtain (GET), and even more, you can instruct a command (POST) through API. Which, we will leverage to instruct Device Isolation in part 2.</p><hr><h2 id=wrapping-up-laying-out-api-foundation-for-boundless-potential>Wrapping Up: Laying Out API Foundation for Boundless Potential</h2><p>You&rsquo;ve now seen how the MDE API works and how to authorize access through Azure App Registration and Key Vault. While this setup alone may not seem powerful yet, it lays the essential groundwork for integrating with Sentinel Logic Apps.</p><p>With this foundation in place, you&rsquo;re ready to start building playbooks that can automate bulk actions—like isolating devices based on tags or groups.</p><p>Next, in <strong>Part 2</strong> we’ll be building the Logic App that ties this all together and makes targeted bulk Isolation possible.</p><hr><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a id=R-logo class=R-default href=/index.html><div class=logo-title>Novian Andrian</div></a></div><search><form action=/search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search></div><div id=R-homelinks class=default-animation><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-homelinks"><ul class="space collapsible-menu"></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-headercontrols"><ul></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div></div><div id=R-content-wrapper class=highlightable><div class="R-sidebarmenu R-shortcutmenu-main"><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/about/index.html><a class=padding href=/about/index.html>. <i class="fa-solid fa-user" style=color:#00aeff></i> About Me</a></li><li data-nav-id=/credentials/index.html><a class=padding href=/credentials/index.html>. <i class="fa-regular fa-address-card" style=color:#00aeff></i> Credentials</a></li><li data-nav-id=/contact/index.html><a class=padding href=/contact/index.html>. <i class="fa-solid fa-envelope" style=color:#00aeff></i> Contact</a></li><li class="parent alwaysopen" data-nav-id=/blog/index.html><input type=checkbox id=R-section-c061e150208a7ab43c1b0b723b79816b aria-controls=R-subsections-c061e150208a7ab43c1b0b723b79816b checked><label for=R-section-c061e150208a7ab43c1b0b723b79816b><i class="fa-fw fas fa-chevron-right"></i><span class=a11y-only>Submenu Blog Post</span></label><a class=padding href=/blog/index.html>. <i class="fa-solid fa-blog fa-bounce" style=color:#ff5757></i> Blog Post</a><ul id=R-subsections-c061e150208a7ab43c1b0b723b79816b class=collapsible-menu><li class=parent data-nav-id=/blog/defender/index.html><input type=checkbox id=R-section-33dd05e5edb8d61a663c9a1412e8164e aria-controls=R-subsections-33dd05e5edb8d61a663c9a1412e8164e checked><label for=R-section-33dd05e5edb8d61a663c9a1412e8164e><i class="fa-fw fas fa-chevron-right"></i><span class=a11y-only>Submenu MS Defender</span></label><a class=padding href=/blog/defender/index.html><i class="fa-sharp-duotone fa-solid fa-shield" style=color:#00aeff></i> MS Defender</a><ul id=R-subsections-33dd05e5edb8d61a663c9a1412e8164e class=collapsible-menu><li data-nav-id=/blog/defender/004.takeresponseapi2/index.html><a class=padding href=/blog/defender/004.takeresponseapi2/index.html>Sentinel Playbook: Device Isolation Using MDE API #2</a></li><li class=active data-nav-id=/blog/defender/003.takeresponseapi1/index.html><a class=padding href=/blog/defender/003.takeresponseapi1/index.html>Sentinel Playbook: Device Isolation Using MDE API #1</a></li><li data-nav-id=/blog/defender/002.live-analyzer/index.html><a class=padding href=/blog/defender/002.live-analyzer/index.html>Live Response to Remotely Collect Defender Logs</a></li><li data-nav-id=/blog/defender/001.mpregistry/index.html><a class=padding href=/blog/defender/001.mpregistry/index.html>Tracking Defender Policy Deployment with Logs</a></li></ul></li></ul></li></ul></div><div class="R-sidebarmenu R-shortcutmenu-shortcuts"><ul class="space collapsible-menu"></ul></div><div id=R-footer-margin></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-footercontrols"><ul></ul></div><div id=R-footer><a href=https://gohugo.io/>Hugo</a> + <a href=https://github.com/McShelby/hugo-theme-relearn>Relearn</a></div></div></aside><script src=/js/js-yaml/js-yaml.min.js?1754897756 defer></script><script src=/js/d3/d3-color.min.js?1754897756 defer></script><script src=/js/d3/d3-dispatch.min.js?1754897756 defer></script><script src=/js/d3/d3-drag.min.js?1754897756 defer></script><script src=/js/d3/d3-ease.min.js?1754897756 defer></script><script src=/js/d3/d3-interpolate.min.js?1754897756 defer></script><script src=/js/d3/d3-selection.min.js?1754897756 defer></script><script src=/js/d3/d3-timer.min.js?1754897756 defer></script><script src=/js/d3/d3-transition.min.js?1754897756 defer></script><script src=/js/d3/d3-zoom.min.js?1754897756 defer></script><script src=/js/mermaid/mermaid.min.js?1754897756 defer></script><script>window.relearn.themeUseMermaid=JSON.parse("{}")</script><script src=/js/clipboard/clipboard.min.js?1754897756 defer></script><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1754897756 defer></script><script src=/js/theme.min.js?1754897756 defer></script></body></html>